<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>Loon 插件仓库</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Loon 插件仓库">
  <meta name="format-detection" content="telephone=no">

  <link rel="icon" href="../Icon/PluginLab/LoonPluginLab.png" type="image/png">
  <link rel="apple-touch-icon" href="../Icon/PluginLab/LoonPluginLab-White.png">

  <style>
    /* =========================================
       1. 变量定义 (CSS Variables)
       ========================================= */
    :root {
      /* 安全区域 - 使用 max 确保有默认边距 */
      --safe-top: env(safe-area-inset-top, 20px);
      --safe-bottom: env(safe-area-inset-bottom, 20px);
      --safe-left: env(safe-area-inset-left, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      
      --header-height: 60px;
      --content-width: 1200px;

      /* 浅色模式 */
      --bg-body: #F2F2F7;
      --bg-card: #FFFFFF;
      --bg-card-hover: rgba(255, 255, 255, 0.8);
      --bg-input: rgba(118, 118, 128, 0.12);
      --bg-glass: rgba(242, 242, 247, 0.8);
      
      --text-primary: #000000;
      --text-secondary: #3C3C43; /* 60% opacity look */
      --text-tertiary: #3C3C43;  /* 30% opacity look */
      
      --color-accent: #007AFF;
      --color-tag-bg: rgba(0, 122, 255, 0.1);
      
      --border-color: rgba(60, 60, 67, 0.1); /* Separator color */
      
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 18px;
    }

    /* 深色模式 */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-body: #000000;
        --bg-card: #1C1C1E;
        --bg-card-hover: #2C2C2E;
        --bg-input: rgba(118, 118, 128, 0.24);
        --bg-glass: rgba(28, 28, 30, 0.8);

        --text-primary: #FFFFFF;
        --text-secondary: #EBEBF5; /* 60% */
        --text-tertiary: #EBEBF5;  /* 30% */
        
        --color-accent: #0A84FF;
        --color-tag-bg: rgba(10, 132, 255, 0.15);
        
        --border-color: rgba(84, 84, 88, 0.35);
        
        --shadow-sm: 0 1px 2px rgba(0,0,0,0.2);
        --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
      }
      
      /* 针对 Safari 橡皮筋效果的修正 */
      body { background-color: #000; }
    }

    /* =========================================
       2. 全局重置 (Reset & Base)
       ========================================= */
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Helvetica, Arial, sans-serif;
      font-size: 16px;
      -webkit-text-size-adjust: 100%;
      scroll-behavior: smooth;
    }

    body {
      background-color: var(--bg-body);
      color: var(--text-primary);
      line-height: 1.5;
      min-height: 100vh;
      /* PWA 优化：防止下拉刷新等默认行为干扰 App 体验 */
      overscroll-behavior-y: none; 
    }

    a { text-decoration: none; color: inherit; }
    button, input { font: inherit; border: none; outline: none; background: none; }
    
    /* 辅助类：文本透明度模拟 */
    .text-secondary { color: var(--text-secondary); opacity: 0.6; }
    .text-tertiary { color: var(--text-tertiary); opacity: 0.3; }

    /* =========================================
       3. 顶部导航栏 (Header)
       ========================================= */
    .app-header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      background-color: var(--bg-glass);
      border-bottom: 0.5px solid var(--border-color);
      
      /* 磨砂玻璃效果 */
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      
      /* 适配刘海屏 padding */
      padding-top: var(--safe-top);
      padding-left: var(--safe-left);
      padding-right: var(--safe-right);
      height: calc(var(--header-height) + var(--safe-top));
      
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .header-inner {
      width: 100%;
      height: 100%;
      padding: 0 16px;
      display: grid;
      /* 左中右布局：左侧logo，中间标题自适应，右侧按钮 */
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 12px;
      max-width: var(--content-width);
      margin: 0 auto;
    }

    /* Logo 区域 */
    .logo-area {
      display: flex;
      align-items: center;
    }
    .logo-img {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: block;
    }

    /* 标题区域 */
    .title-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      overflow: hidden;
    }
    .app-title {
      font-size: 17px;
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      width: 100%;
    }
    .app-subtitle {
      font-size: 11px;
      margin-top: -2px;
    }

    /* 菜单按钮区域 */
    .controls-area {
      display: flex;
      justify-content: flex-end;
      min-width: 32px; /* 占位，保持平衡 */
    }

    /* 汉堡菜单按钮 */
    .burger-btn {
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-end;
      gap: 5px;
      cursor: pointer;
      position: relative;
      z-index: 1002;
    }
    .burger-line {
      width: 20px;
      height: 2px;
      background-color: var(--color-accent);
      border-radius: 2px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .burger-line:nth-child(2) { width: 14px; }
    
    /* 激活态 */
    .burger-btn.active .burger-line:nth-child(1) { transform: translateY(7px) rotate(45deg); width: 22px; background-color: var(--text-primary); }
    .burger-btn.active .burger-line:nth-child(2) { opacity: 0; }
    .burger-btn.active .burger-line:nth-child(3) { transform: translateY(-7px) rotate(-45deg); width: 22px; background-color: var(--text-primary); }

    /* 下拉菜单 (Mobile) */
    .dropdown-menu {
      position: absolute;
      top: calc(100% + 8px);
      right: 16px;
      background: var(--bg-card);
      border-radius: var(--radius-md);
      padding: 8px;
      box-shadow: var(--shadow-md);
      width: 160px;
      transform-origin: top right;
      transform: scale(0.9) opacity(0);
      visibility: hidden;
      transition: all 0.25s cubic-bezier(0.1, 0.9, 0.2, 1);
      border: 0.5px solid var(--border-color);
    }
    .dropdown-menu.active {
      transform: scale(1) opacity(1);
      visibility: visible;
    }
    .menu-link {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      font-size: 15px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .menu-link:active {
      background-color: var(--bg-input);
    }

    /* 图标遮罩 */
    .icon-mask {
      width: 20px;
      height: 20px;
      background-color: var(--text-primary);
      -webkit-mask-repeat: no-repeat;
      mask-repeat: no-repeat;
      -webkit-mask-size: contain;
      mask-size: contain;
      -webkit-mask-position: center;
      mask-position: center;
    }
    .icon-tg { -webkit-mask-image: url('../Icon/PluginLab/Telegram.svg'); mask-image: url('../Icon/PluginLab/Telegram.svg'); }
    .icon-git { -webkit-mask-image: url('../Icon/PluginLab/GitHub.svg'); mask-image: url('../Icon/PluginLab/GitHub.svg'); }

    /* =========================================
       4. 主内容区域 (Main Layout)
       ========================================= */
    .main-wrapper {
      width: 100%;
      max-width: var(--content-width);
      margin: 0 auto;
      /* 顶部避让 Header，底部避让 Safe Area */
      padding-top: calc(var(--header-height) + var(--safe-top) + 20px);
      padding-bottom: calc(var(--safe-bottom) + 30px);
      padding-left: calc(16px + var(--safe-left));
      padding-right: calc(16px + var(--safe-right));
    }

    /* 公告条 */
    .banner {
      background-color: var(--bg-card);
      border: 1px solid var(--border-color); /* 边框代替纯背景色，更适配深色模式 */
      border-left: 4px solid #FFCC00; /* 醒目的左边框 */
      border-radius: var(--radius-md);
      height: 48px;
      margin-bottom: 24px;
      overflow: hidden;
      position: relative;
      cursor: pointer;
      box-shadow: var(--shadow-sm);
    }
    .banner-text {
      position: absolute;
      top: 0; left: 0; bottom: 0; right: 0;
      display: flex;
      align-items: center;
      padding: 0 16px;
      font-size: 14px;
      font-weight: 500;
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.4s ease, transform 0.4s ease;
      white-space: nowrap;
    }
    .banner-text.active {
      opacity: 1;
      transform: translateY(0);
      z-index: 1;
    }

    /* 搜索与筛选区 */
    .filter-section {
      margin-bottom: 24px;
    }
    
    .search-wrapper {
      position: relative;
      margin-bottom: 16px;
    }
    .search-input {
      width: 100%;
      height: 44px;
      padding: 0 16px;
      border-radius: 10px;
      background-color: var(--bg-input);
      color: var(--text-primary);
      font-size: 16px;
      transition: background 0.2s, box-shadow 0.2s;
    }
    .search-input:focus {
      background-color: var(--bg-card);
      box-shadow: 0 0 0 2px var(--color-accent);
    }

    .tabs-scroll {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      padding-bottom: 4px; /* 预留滚动条空间（虽然隐藏了） */
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE/Edge */
    }
    .tabs-scroll::-webkit-scrollbar { display: none; }
    
    .tab-btn {
      padding: 8px 16px;
      border-radius: 20px;
      background-color: var(--bg-card);
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
      transition: all 0.2s;
      border: 0.5px solid var(--border-color);
    }
    .tab-btn.active {
      background-color: var(--color-accent);
      color: #FFF;
      border-color: transparent;
      box-shadow: 0 4px 10px rgba(0, 122, 255, 0.3);
    }
    @media (hover: hover) {
      .tab-btn:hover:not(.active) {
        background-color: var(--bg-input);
      }
    }

    /* 列表标题 */
    .section-header {
      font-size: 22px;
      font-weight: 700;
      margin: 30px 0 16px;
      padding-left: 4px;
    }

    /* =========================================
       5. 插件卡片 (Grid Layout)
       ========================================= */
    .plugin-grid {
      display: grid;
      /* 自适应列宽，手机端通常1列，折叠屏/平板2列，桌面3-4列 */
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 16px;
    }

    .plugin-card {
      background-color: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 16px;
      display: flex;
      flex-direction: column;
      position: relative;
      transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
      border: 0.5px solid transparent;
      box-shadow: var(--shadow-sm);
    }

    /* 桌面端 Hover 效果 */
    @media (hover: hover) {
      .plugin-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
        background-color: var(--bg-card-hover);
        border-color: var(--border-color);
        z-index: 10;
      }
    }
    /* 移动端点击反馈 */
    .plugin-card:active {
      transform: scale(0.98);
      background-color: var(--bg-input);
    }

    .card-top {
      display: flex;
      gap: 14px;
      margin-bottom: 12px;
    }
    
    .card-icon {
      width: 56px;
      height: 56px;
      border-radius: 14px;
      object-fit: cover;
      background-color: var(--bg-input);
      border: 0.5px solid var(--border-color);
      flex-shrink: 0;
    }

    .card-meta {
      flex: 1;
      min-width: 0; /* Flex子项溢出省略关键 */
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .card-date {
      font-size: 12px;
      color: var(--text-tertiary);
      opacity: 0.6;
    }

    .card-desc {
      font-size: 14px;
      color: var(--text-secondary);
      opacity: 0.8;
      line-height: 1.5;
      margin-bottom: 16px;
      /* 限制两行 */
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      flex-grow: 1; /* 撑满高度，使 Tags 底部对齐 */
    }

    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: auto;
    }
    .tag {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 6px;
      background-color: var(--color-tag-bg);
      color: var(--color-accent);
      font-weight: 500;
    }

    /* 空状态 */
    .empty-state {
      grid-column: 1 / -1;
      text-align: center;
      padding: 60px 0;
      color: var(--text-tertiary);
      opacity: 0.5;
    }

    /* 页脚 */
    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 12px;
      color: var(--text-tertiary);
      opacity: 0.5;
      line-height: 2;
    }

    /* =========================================
       6. 桌面端适配 (Desktop Query)
       ========================================= */
    @media (min-width: 768px) {
      .header-inner {
        padding: 0 32px;
      }
      
      /* 隐藏汉堡按钮 */
      .burger-btn { display: none; }
      
      /* 菜单变为行内显示 */
      .dropdown-menu {
        position: static;
        width: auto;
        box-shadow: none;
        background: none;
        border: none;
        padding: 0;
        visibility: visible;
        opacity: 1;
        transform: none;
        display: flex;
        gap: 8px;
      }
      
      .menu-link {
        padding: 8px 12px;
        background: transparent;
        font-size: 14px;
        border-radius: 20px;
        transition: background 0.2s;
      }
      .menu-link:hover {
        background-color: var(--bg-input);
      }
      
      .menu-link span:not(.icon-mask) {
        display: none; /* 仅显示图标，或可选择显示文字 */
      }
      @media (min-width: 1024px) {
         .menu-link span:not(.icon-mask) { display: inline; } /* 大屏显示文字 */
      }
      
      .main-wrapper {
        padding-left: 32px;
        padding-right: 32px;
      }
    }
  </style>
</head>

<body>
  <header class="app-header">
    <div class="header-inner">
      <div class="logo-area">
        <a href="javascript:location.reload();" title="刷新页面">
          <img src="../Icon/PluginLab/LoonPluginLab.png" alt="Logo" class="logo-img">
        </a>
      </div>
      
      <div class="title-area">
        <h1 class="app-title">Loon 插件仓库</h1>
        <p class="app-subtitle text-secondary">点击卡片即可一键导入</p>
      </div>

      <div class="controls-area">
        <div id="menu-toggle" class="burger-btn" aria-label="菜单">
          <span class="burger-line"></span>
          <span class="burger-line"></span>
          <span class="burger-line"></span>
        </div>
        
        <nav id="secondary-menu" class="dropdown-menu">
          <a href="https://t.me/BoEchoBot" target="_blank" class="menu-link">
            <i class="icon-mask icon-tg"></i>
            <span>Telegram</span>
          </a>
          <a href="https://github.com/sooyaaabo/Loon" target="_blank" class="menu-link">
            <i class="icon-mask icon-git"></i>
            <span>GitHub</span>
          </a>
        </nav>
      </div>
    </div>
  </header>

  <div class="main-wrapper">
    <div class="banner" id="announcementBanner">
      </div>

    <div class="filter-section">
      <div class="search-wrapper">
        <input id="search" class="search-input" placeholder="搜索插件名称、描述或标签…">
      </div>
      <div class="tabs-scroll tabs">
        <button class="tab-btn active" data-cat="all">全部</button>
        <button class="tab-btn" data-cat="去广告">去广告</button>
        <button class="tab-btn" data-cat="功能增强">功能增强</button>
        <button class="tab-btn" data-cat="解锁会员">解锁会员</button>
        <button class="tab-btn" data-cat="定时任务">定时任务</button>
      </div>
    </div>

    <div class="section-header" id="sectionTitle">正在加载…</div>
    
    <div class="plugin-grid list" id="list">
      <div class="empty-state">正在与 GitHub 通信…</div>
    </div>

    <footer>
      <span>更新时间：</span><span id="updateTime">--</span><br>
      Copyright &copy; <span id="copyright-year">2025</span> sooyaaabo. All rights reserved.
    </footer>
  </div>

  <script>
    // 保持 JS 逻辑不变，仅更新了类名引用以匹配新样式
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    (async () => {
      const TEXT = {
        repoTitle: 'Loon 插件仓库',
        repoDesc: '点击卡片即可一键导入', // 微调文案
        bannerWarning: '禁止在中华人民共和国境内平台公开传播本仓库内容以及将其用于任何商业或非法用途！',
        bannerDisclaimer: '本网站由个人制作与维护，与 Loon 官方无关。',
        bannerUpdateNotice: '如果插件提示“Loon的版本过旧”，请前往 App Store 更新软件。',
        loadingPlugins: '正在从 GitHub 加载插件列表…',
        loadFailed: (msg) => `加载失败：${msg}`,
        noPluginsFound: '仓库中未找到 .lpx 文件',
        noMatch: '没有找到匹配的插件',
        sectionTitle: (cat, count) => `${cat} · ${count}`,
        cardNoDesc: '暂无描述',
        catAll: '全部',
        catAdblock: '去广告',
        catEnhance: '增强',
        catUnlock: '解锁',
        catCron: '任务'
      };

      const menuToggle = document.getElementById('menu-toggle');
      const secondaryMenu = document.getElementById('secondary-menu');
      const listEl = document.getElementById('list');
      const searchEl = document.getElementById('search');
      const tabsEl = document.querySelector('.tabs');
      const sectionTitleEl = document.getElementById('sectionTitle');
      const updateTimeEl = document.getElementById('updateTime');

      // Banner Init
      const bannerContainer = document.getElementById('announcementBanner');
      [TEXT.bannerWarning, TEXT.bannerDisclaimer, TEXT.bannerUpdateNotice].forEach((msg, i) => {
        const div = document.createElement('div');
        div.className = `banner-text ${i === 0 ? 'active' : ''}`; // 使用 div 配合 flex
        div.textContent = msg;
        bannerContainer.appendChild(div);
      });

      document.querySelector('.app-title').textContent = TEXT.repoTitle;
      document.querySelector('.app-subtitle').textContent = TEXT.repoDesc;
      document.querySelector('#copyright-year').textContent = new Date().getFullYear();

      // Tab 文字更新
      document.querySelectorAll('.tab-btn').forEach(btn => {
         const cat = btn.dataset.cat;
         // 简单映射，保持逻辑
         let label = cat;
         if(cat === 'all') label = TEXT.catAll;
         else if(cat === '去广告') label = TEXT.catAdblock;
         else if(cat === '功能增强') label = TEXT.catEnhance;
         else if(cat === '解锁会员') label = TEXT.catUnlock;
         else if(cat === '定时任务') label = TEXT.catCron;
         btn.textContent = label;
      });

      // Data Fetching
      let plugins = [];
      const GITHUB_REPO = 'sooyaaabo/Loon';
      const PLUGIN_DIR_PATH = 'Plugin';

      try {
        const allFilesRes = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${PLUGIN_DIR_PATH}`);
        const allFiles = await allFilesRes.json();
        if (!Array.isArray(allFiles)) throw new Error('API Error');
        
        const pluginFiles = allFiles.filter(f => f.name.toLowerCase().endsWith('.lpx'));
        if (!pluginFiles.length) throw new Error(TEXT.noPluginsFound);

        const pluginContents = await Promise.all(pluginFiles.map(f => fetch(f.download_url).then(r => r.text())));
        
        plugins = pluginContents.map((text, i) => {
          const file = pluginFiles[i];
          const name = (text.match(/#!\s*name\s*=\s*(.+)/i) || [])[1]?.trim() || file.name;
          const desc = (text.match(/#!\s*desc\s*=\s*(.+)/i) || [])[1]?.trim() || TEXT.cardNoDesc;
          const icon = (text.match(/#!\s*icon\s*=\s*(.+)/i) || [])[1]?.trim() || '';
          const date = (text.match(/#!\s*date\s*=\s*(.+)/i) || [])[1]?.trim() || 'Unknown';
          const tagStr = (text.match(/#!\s*tag\s*=\s*(.+)/i) || [])[1]?.trim();
          const tags = tagStr ? tagStr.split(',').map(t => t.trim()).filter(Boolean) : [];
          return { url: file.download_url, name, desc, icon, date, tags };
        });
      } catch (err) {
        listEl.innerHTML = `<div class="empty-state">${TEXT.loadFailed(err.message)}</div>`;
        return;
      }

      // Time
      try {
        const commits = await (await fetch(`https://api.github.com/repos/${GITHUB_REPO}/commits?path=${PLUGIN_DIR_PATH}`)).json();
        const latest = commits[0]?.commit?.author?.date;
        if (latest) updateTimeEl.textContent = new Date(latest).toLocaleString('zh-CN', {month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit'});
      } catch {}

      // Render
      function render(cat = 'all', kw = '') {
        const lowKw = kw.toLowerCase();
        const filtered = plugins.filter(p => {
          const hitCat = cat === 'all' || p.tags.includes(cat);
          const hitKw = !lowKw || p.name.toLowerCase().includes(lowKw) || p.tags.some(t => t.toLowerCase().includes(lowKw));
          return hitCat && hitKw;
        });

        // Update Title
        const activeTab = tabsEl.querySelector(`[data-cat="${cat}"]`);
        sectionTitleEl.textContent = TEXT.sectionTitle(activeTab ? activeTab.textContent : '列表', filtered.length);
        
        listEl.innerHTML = '';
        if (!filtered.length) {
          listEl.innerHTML = `<div class="empty-state">${TEXT.noMatch}</div>`;
          return;
        }

        filtered.forEach(p => {
          const card = document.createElement('a');
          card.className = 'plugin-card';
          card.href = `loon://import?plugin=${encodeURIComponent(p.url)}`;
          
          const tagsHtml = p.tags.map(t => `<span class="tag">${t}</span>`).join('');
          
          card.innerHTML = `
            <div class="card-top">
              ${p.icon ? `<img src="${p.icon}" class="card-icon" loading="lazy">` : `<div class="card-icon" style="display:flex;align-items:center;justify-content:center;color:#ccc">L</div>`}
              <div class="card-meta">
                <div class="card-title">${p.name}</div>
                <div class="card-date">${p.date}</div>
              </div>
            </div>
            <div class="card-desc">${p.desc}</div>
            <div class="card-tags">${tagsHtml}</div>
          `;
          listEl.appendChild(card);
        });
      }

      // Listeners
      menuToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        menuToggle.classList.toggle('active');
        secondaryMenu.classList.toggle('active');
      });
      document.addEventListener('click', (e) => {
        if (!secondaryMenu.contains(e.target) && !menuToggle.contains(e.target)) {
          menuToggle.classList.remove('active');
          secondaryMenu.classList.remove('active');
        }
      });

      tabsEl.addEventListener('click', e => {
        if (e.target.classList.contains('tab-btn')) {
          tabsEl.querySelector('.active').classList.remove('active');
          e.target.classList.add('active');
          render(e.target.dataset.cat, searchEl.value);
        }
      });

      searchEl.addEventListener('input', () => {
        const activeCat = tabsEl.querySelector('.active').dataset.cat;
        render(activeCat, searchEl.value);
      });

      // Banner Animation (Optimized)
      const bannerItems = document.querySelectorAll('.banner-text');
      if (bannerItems.length > 1) {
        let idx = 0;
        const rotate = () => {
          bannerItems[idx].classList.remove('active');
          idx = (idx + 1) % bannerItems.length;
          bannerItems[idx].classList.add('active');
        };
        setInterval(rotate, 5000); // 简单的 5秒切换，不做复杂的文字滚动检测以提升性能
      }

      // Init
      if (plugins.length) render();
    })();
  </script>
</body>
</html>
